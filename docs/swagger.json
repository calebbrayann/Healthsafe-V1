{
  "openapi": "3.0.3",
  "info": {
    "title": "HealthSafe API",
    "version": "1.0.0",
    "description": "Documentation complète des endpoints HealthSafe"
  },
  "servers": [
    {
      "url": "https://healthsafe-v1-production.up.railway.app/api",
      "description": "Serveur de production"
    },
    {
      "url": "http://localhost:3000/api",
      "description": "Serveur local"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "tags": [
    { "name": "Auth", "description": "Gestion utilisateurs et authentification" },
    { "name": "Dossiers", "description": "Gestion des dossiers médicaux" },
    { "name": "Accès", "description": "Gestion des demandes d’accès aux dossiers" },
    { "name": "Admin", "description": "Fonctionnalités administratives" }
  ],
  "paths": {
    "/auth/register-patient": {
      "post": {
        "tags": ["Auth"],
        "summary": "Inscription d’un patient",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["nom", "prenom", "email", "password", "codePatient"],
                "properties": {
                  "nom": { "type": "string", "example": "Mboumba" },
                  "prenom": { "type": "string", "example": "Caleb" },
                  "email": { "type": "string", "format": "email", "example": "patient@healthsafe.com" },
                  "password": { "type": "string", "example": "MotDePasse123!" },
                  "codePatient": { "type": "string", "example": "PAT-001" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Patient créé avec succès" },
          "400": { "description": "Données invalides" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/register-medecin": {
      "post": {
        "tags": ["Auth"],
        "summary": "Inscription d’un médecin",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["nom", "prenom", "email", "password", "numeroLicence", "specialite", "hopital"],
                "properties": {
                  "nom": { "type": "string", "example": "Ngoma" },
                  "prenom": { "type": "string", "example": "Brayann" },
                  "email": { "type": "string", "format": "email", "example": "medecin@hopital.com" },
                  "password": { "type": "string", "example": "MotDePasse456!" },
                  "numeroLicence": { "type": "string", "example": "LIC-2025-001" },
                  "specialite": { "type": "string", "example": "Cardiologie" },
                  "hopital": { "type": "string", "example": "CHU Libreville" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Médecin créé avec succès" },
          "400": { "description": "Données invalides" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "Connexion",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": { "type": "string", "format": "email", "example": "admin@hopital.com" },
                  "password": { "type": "string", "example": "MotDePasse789!" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Connexion réussie" },
          "400": { "description": "Données invalides" },
          "401": { "description": "Email ou mot de passe incorrect" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "Déconnexion",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Déconnexion réussie" },
          "401": { "description": "Non authentifié" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/verify/{token}": {
      "get": {
        "tags": ["Auth"],
        "summary": "Vérification email via token",
        "parameters": [
          {
            "name": "token",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Email vérifié avec succès" },
          "400": { "description": "Token invalide ou expiré" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/request-reset-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Demande de réinitialisation du mot de passe",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email"],
                "properties": {
                  "email": { "type": "string", "format": "email", "example": "patient@healthsafe.com" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Email de réinitialisation envoyé" },
          "400": { "description": "Email invalide" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/reset-password/{token}": {
      "post": {
        "tags": ["Auth"],
        "summary": "Réinitialisation du mot de passe",
        "parameters": [
          {
            "name": "token",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["password"],
                "properties": {
                  "password": { "type": "string", "example": "NouveauMotDePasse!" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Mot de passe réinitialisé" },
          "400": { "description": "Token invalide ou expiré" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },
    "/auth/reset-code-patient": {
      "post": {
        "tags": ["Auth"],
        "summary": "Générer un nouveau code patient",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Nouveau code patient généré" },
          "401": { "description": "Non authentifié" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers": {
      "post": {
        "tags": ["Dossiers"],
        "summary": "Créer un dossier médical pour un patient",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["numeroDossier", "patientId", "diagnostic"],
                "properties": {
                  "numeroDossier": { "type": "string", "example": "DOS-001" },
                  "patientId": { "type": "integer", "example": 12 },
                  "diagnostic": { "type": "string", "example": "Hypertension" },
                  "traitement": { "type": "string", "example": "Bêta-bloquants" },
                  "notes": { "type": "string", "example": "Suivi mensuel recommandé" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Dossier créé avec succès" },
          "400": { "description": "Données invalides" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers/{numeroDossier}": {
      "get": {
        "tags": ["Dossiers"],
        "summary": "Lire un dossier et enregistrer l’accès",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "numeroDossier",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Dossier récupéré avec succès" },
          "404": { "description": "Dossier introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      },
      "put": {
        "tags": ["Dossiers"],
        "summary": "Mettre à jour un dossier",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "numeroDossier",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "diagnostic": { "type": "string" },
                  "traitement": { "type": "string" },
                  "notes": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Dossier mis à jour" },
          "400": { "description": "Données invalides" },
          "404": { "description": "Dossier introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers/{numeroDossier}/historique": {
      "get": {
        "tags": ["Dossiers"],
        "summary": "Historique des accès du dossier",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "numeroDossier",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Historique récupéré avec succès" },
          "404": { "description": "Dossier introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers/{numeroDossier}/autoriser": {
      "post": {
        "tags": ["Dossiers"],
        "summary": "Autoriser un médecin à accéder au dossier",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "numeroDossier",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["medecinId"],
                "properties": {
                  "medecinId": { "type": "integer", "example": 7 }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Médecin autorisé" },
          "400": { "description": "Données invalides" },
          "404": { "description": "Dossier ou médecin introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers/{numeroDossier}/upload": {
      "post": {
        "tags": ["Dossiers"],
        "summary": "Upload de fichier dans le dossier",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "numeroDossier",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": { "type": "string", "format": "binary" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Fichier uploadé avec succès" },
          "400": { "description": "Fichier invalide" },
          "404": { "description": "Dossier introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers/{numeroDossier}/autorisations": {
      "get": {
        "tags": ["Dossiers"],
        "summary": "Lister les autorisations pour le dossier",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "numeroDossier",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Autorisations récupérées" },
          "404": { "description": "Dossier introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/dossiers/patient": {
      "post": {
        "tags": ["Dossiers"],
        "summary": "Lister tous les dossiers d’un patient",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["patientId"],
                "properties": {
                  "patientId": { "type": "integer", "example": 12 }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Dossiers récupérés" },
          "404": { "description": "Patient introuvable" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },

    "/api/acces/demander": {
  "post": {
    "tags": ["Acces"],
    "summary": "MEDECIN : Faire une demande d'accès à un patient",
    "security": [{ "bearerAuth": [] }],
    "requestBody": {
      "required": true,
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "required": ["codePatient"],
            "properties": {
              "codePatient": { "type": "string" }
            }
          }
        }
      }
    },
    "responses": {
      "201": { "description": "Demande d'accès créée avec succès" },
      "400": { "description": "Une demande est déjà en attente" },
      "403": { "description": "Seul un médecin peut demander un accès" },
      "404": { "description": "Patient introuvable" },
      "500": { "description": "Erreur serveur" }
    }
  }
},
  "/api/acces/repondre/{demandeId}": {
  "post": {
    "tags": ["Acces"],
    "summary": "PATIENT : Accepter ou refuser une demande d'accès",
    "security": [{ "bearerAuth": [] }],
    "parameters": [
      {
        "name": "demandeId",
        "in": "path",
        "required": true,
        "schema": { "type": "integer" },
        "description": "ID de la demande"
      }
    ],
    "requestBody": {
      "required": true,
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "required": ["decision"],
            "properties": {
              "decision": { "type": "string", "enum": ["ACCEPTEE", "REFUSEE"] }
            }
          }
        }
      }
    },
    "responses": {
      "200": { "description": "Demande traitée avec succès" },
      "400": { "description": "Décision invalide" },
      "403": { "description": "Seul un patient peut répondre" },
      "404": { "description": "Demande introuvable" },
      "500": { "description": "Erreur serveur" }
    }
  }
},
  "/api/acces/revoquer": {
  "post": {
    "tags": ["Acces"],
    "summary": "PATIENT : Révoquer l'accès d'un médecin",
    "security": [{ "bearerAuth": [] }],
    "requestBody": {
      "required": true,
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "required": ["nom", "prenom", "numeroLicence"],
            "properties": {
              "nom": { "type": "string" },
              "prenom": { "type": "string" },
              "numeroLicence": { "type": "string" }
            }
          }
        }
      }
    },
    "responses": {
      "200": { "description": "Accès révoqué avec succès" },
      "403": { "description": "Seul un patient peut révoquer" },
      "404": { "description": "Médecin introuvable" },
      "500": { "description": "Erreur serveur" }
    }
  }
},
"/api/acces/liste": {
  "get": {
    "tags": ["Acces"],
    "summary": "PATIENT : Lister tous les médecins autorisés",
    "security": [{ "bearerAuth": [] }],
    "responses": {
      "200": { "description": "Liste des accès récupérée" },
      "403": { "description": "Seul un patient peut consulter" },
      "500": { "description": "Erreur serveur" }
    }
  }
},
    "/admin/promouvoir": {
      "post": {
        "tags": ["Admin"],
        "summary": "SUPER_ADMIN : Promouvoir un médecin en Admin d’hôpital",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["nom", "prenom", "numeroLicence", "hopital"],
                "properties": {
                  "nom": { "type": "string" },
                  "prenom": { "type": "string" },
                  "numeroLicence": { "type": "string" },
                  "hopital": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Médecin promu avec succès" },
          "400": { "description": "Données manquantes ou invalides" },
          "404": { "description": "Médecin introuvable" },
          "403": { "description": "Accès interdit" },
          "500": { "description": "Erreur serveur" }
        }
      }
    },  "/api/admin/valider-medecin": {
    "post": {
      "tags": ["Admin"],
      "summary": "ADMIN_HOPITAL : Valider un médecin",
      "security": [{ "bearerAuth": [] }],
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": ["nom", "prenom"],
              "properties": {
                "nom": { "type": "string" },
                "prenom": { "type": "string" }
              }
            }
          }
        }
      },
      "responses": {
        "200": { "description": "Médecin validé avec succès" },
        "400": { "description": "Données manquantes" },
        "403": { "description": "Non autorisé" },
        "404": { "description": "Médecin introuvable" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/medecins": {
    "get": {
      "tags": ["Admin"],
      "summary": "ADMIN_HOPITAL : Lister tous les médecins de l’hôpital",
      "security": [{ "bearerAuth": [] }],
      "responses": {
        "200": { "description": "Liste des médecins récupérée" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/medecins/search": {
    "get": {
      "tags": ["Admin"],
      "summary": "Rechercher des médecins (filtrage)",
      "security": [{ "bearerAuth": [] }],
      "parameters": [
        { "name": "email", "in": "query", "schema": { "type": "string" } },
        { "name": "numeroLicence", "in": "query", "schema": { "type": "string" } },
        { "name": "nom", "in": "query", "schema": { "type": "string" } },
        { "name": "hopital", "in": "query", "schema": { "type": "string" } }
      ],
      "responses": {
        "200": { "description": "Médecins filtrés récupérés" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/revoquer-admin": {
    "post": {
      "tags": ["Admin"],
      "summary": "SUPER_ADMIN : Révoquer un admin d’hôpital",
      "security": [{ "bearerAuth": [] }],
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": ["email"],
              "properties": {
                "email": { "type": "string" }
              }
            }
          }
        }
      },
      "responses": {
        "200": { "description": "Admin révoqué avec succès" },
        "400": { "description": "Email manquant" },
        "404": { "description": "Admin introuvable" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/supprimer-medecin": {
    "post": {
      "tags": ["Admin"],
      "summary": "ADMIN_HOPITAL : Supprimer/révoquer un médecin",
      "security": [{ "bearerAuth": [] }],
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": ["email"],
              "properties": {
                "email": { "type": "string" }
              }
            }
          }
        }
      },
      "responses": {
        "200": { "description": "Médecin révoqué avec succès" },
        "400": { "description": "Email manquant" },
        "404": { "description": "Médecin introuvable" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/utilisateurs": {
    "get": {
      "tags": ["Admin"],
      "summary": "Lister tous les utilisateurs avec filtre rôle / actif",
      "security": [{ "bearerAuth": [] }],
      "parameters": [
        { "name": "role", "in": "query", "schema": { "type": "string" } },
        { "name": "actif", "in": "query", "schema": { "type": "boolean" } }
      ],
      "responses": {
        "200": { "description": "Liste des utilisateurs récupérée" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/reactiver/{id}": {
    "post": {
      "tags": ["Admin"],
      "summary": "Réactiver un utilisateur désactivé",
      "security": [{ "bearerAuth": [] }],
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "integer" },
          "description": "ID de l'utilisateur à réactiver"
        }
      ],
      "responses": {
        "200": { "description": "Utilisateur réactivé avec succès" },
        "404": { "description": "Utilisateur introuvable" },
        "500": { "description": "Erreur serveur" }
      }
    }
  },
  "/api/admin/logs": {
    "get": {
      "tags": ["Admin"],
      "summary": "Lister tous les logs d’audit",
      "security": [{ "bearerAuth": [] }],
      "responses": {
        "200": { "description": "Logs récupérés avec succès" },
        "500": { "description": "Erreur serveur" }
      }
    }
  }
}
}